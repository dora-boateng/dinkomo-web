{"version":3,"sources":["app.js","dialogs.js","forms.js","resources.js","utilities.js","plugins/alphabet-field.js","plugins/dictionary.js","plugins/lang-search.js"],"names":["App","_kbFocus","init","this","root","$","attr","isLocalEnvironment","window","location","hostname","match","ajaxSetup","headers","X-CSRF-TOKEN","document","ready","Dialogs","Forms","tooltip","log","bind","setKeyboardFocus","input","keyboardInput","letter","value","focus","openDialog","id","console","open","closeDialogs","close","redirect","path","length","urlencode","str","encodeURIComponent","toString","replace","msg","click","dropdown","dialog","hide","toggle","box","is","fadeIn","fadeOut","setupAddResourceForm","find","val","addResource","code","addResourceDialogForm","lang","trim","type","_def","draggable","drag","event","Utilities","scroll","scrollSensitivity","getDefinitionForm","name","setupLangSearch","items","max","plugins","selectize","valueField","labelField","searchField","options","create","maxItems","render","item","escape","score","search","getScoreFunction","option","title","parentName","hint","altNames","load","query","callback","ajax","url","error","success","results","setupDefinitionLookup","form","q","clear","language","langCode","langName","submit","preventDefault","data","html","endpoint","xhr","status","each","i","res","resourceType","parentData","parentLanguage","uri","subType","translation","practical","eng","mainLanguage","resetDefinition","lookupDefinition","setDefinitionResult","obj","definitions","def","en","Resources","checkDefinitionTitle","addClass","onError","onSuccess","findDefinitionByTitle","setData","key","localStorage","setItem","setState","sessionStorage","getState","getItem","info","fn","alphabetField","selectizeItems","Array","isArray","undefined","itemsArray","push","selectizePlugins","onItemAdd","jQuery","DiNkomoDictionary","container","clearedContainer","onSubmit","onSubmitError","formatLanguageResult","formatDefinitionResult","row","parentCode","parentUri","definition","mainTitle","langSearch"],"mappings":"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","file":"dinkomo.js","sourcesContent":["/**\r\n * Copyright Di Nkomo(TM) 2015, all rights reserved\r\n *\r\n */\r\nvar App =\r\n{\r\n\r\n    _kbFocus: null,\r\n\r\n\tinit: function()\r\n\t{\r\n\t\t// Save URL root for redirects.\r\n        this.root = $('base').attr('href');\r\n\r\n        // Set the environment of the app.\r\n        this.isLocalEnvironment = (\r\n            window.location.hostname == 'localhost' ||\r\n            window.location.hostname.match(/.*\\.local$/i) ||\r\n            window.location.hostname.match(/.*\\.vagrant$/i)\r\n        ) ? true : false;\r\n\r\n        // Setup AJAX headers.\r\n        $.ajaxSetup({\r\n            headers: {\r\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\r\n            }\r\n        });\r\n\r\n        // Initialize other objects.\r\n        $(document).ready(function() {\r\n\r\n            Dialogs.init();\r\n            Forms.init();\r\n\r\n            // Setup Bootstrap tooltips.\r\n            $('[data-toggle=\"tooltip\"]').tooltip();\r\n\r\n            this.log('App initialized.');\r\n        }.bind(this));\r\n\t},\r\n\r\n    /**\r\n     *\r\n     */\r\n    setKeyboardFocus: function(input) {\r\n        this._kbFocus   = input;\r\n    },\r\n\r\n    /**\r\n     * TODO: insert letter at cursor, not at the end of the string.\r\n     */\r\n    keyboardInput: function(letter)\r\n    {\r\n        if (this._kbFocus) {\r\n            this._kbFocus.value = this._kbFocus.value + letter;\r\n            this._kbFocus.focus();\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n\topenDialog : function(id)\r\n\t{\r\n\t\tconsole.log('App.openDialog deprecated');\r\n\r\n        return Dialogs.open(id);\r\n\t},\r\n\r\n\tcloseDialogs : function()\r\n    {\r\n\t\tconsole.log('App.closeDialogs deprecated');\r\n\r\n        return Dialogs.close();\r\n\t},\r\n\r\n\tredirect: function(path) {\r\n\t\twindow.location = path.length > 1 ? this.root + path : this.root;\r\n\t},\r\n\r\n\turlencode : function(str)\r\n\t{\r\n\t\treturn encodeURIComponent((str + '').toString())\r\n    \t\t.replace(/!/g, '%21')\r\n    \t\t.replace(/'/g, '%27')\r\n    \t\t.replace(/\\(/g, '%28')\r\n    \t\t.replace(/\\)/g, '%29')\r\n    \t\t.replace(/\\*/g, '%2A')\r\n    \t\t.replace(/%20/g, '+');\r\n\t},\r\n\r\n\tlog: function(msg) {\r\n\t\tif (console && this.isLocalEnvironment) {\r\n            console.log('App.js - '+ msg);\r\n        }\r\n\t}\r\n};\r\n\r\nApp.init();\r\n","/**\r\n * Copyright Di Nkomo(TM) 2015, all rights reserved\r\n *\r\n */\r\nvar Dialogs =\r\n{\r\n    init: function() {\r\n\r\n    \t// Attach event listeners.\r\n    \t$('.close').click(App.closeDialogs.bind(App));\r\n        // $('.has-tooltip').popup({on: 'hover'});\r\n        // $('.has-inline-tooltip').popup({inline: true, on: 'hover'});\r\n        $('.has-dropdown-menu').dropdown();\r\n    },\r\n\r\n    open: function(dialog)\r\n    {\r\n\t\t$('.dialog').hide();\r\n        return this.toggle(dialog);\r\n    },\r\n\r\n    toggle: function(dialog)\r\n    {\r\n        box\t= '.dialog.'+ dialog;\r\n        if ($(box).is(':hidden')) $(box).fadeIn(240);\r\n        else $(box).fadeOut(240);\r\n        return false;\r\n    },\r\n\r\n\tclose : function() {\r\n\t\t$('.dialog').fadeOut(240);\r\n\t\treturn false;\r\n\t},\r\n\r\n    //\r\n    // \"Add resource\" dialog.\r\n    //\r\n\r\n    setupAddResourceForm: function(input)\r\n    {\r\n        // Semantic UI search input.\r\n        // $(input).search({\r\n        //     apiSettings: {\r\n        //         method : 'POST',\r\n        //         url: 'language/search/{query}?semantic=1'\r\n        //     },\r\n        //     searchFields: ['name', 'alt_names'],\r\n        //     searchDelay: 500,\r\n        //     searchFullText: false,\r\n        //     onSelect: function(result, response) {\r\n        //         document.addResourceDialogForm.lang.value = result.code;\r\n        //     }\r\n        // });\r\n\r\n        // Clear input.\r\n        $(input).find('.prompt').val('');\r\n    },\r\n\r\n    addResource: function()\r\n    {\r\n        // Get language code.\r\n        var code = document.addResourceDialogForm.lang.value.trim();\r\n        if (code.length < 3) {\r\n            return false;\r\n        }\r\n\r\n        App.redirect(code +'/+'+ $(document.addResourceDialogForm.type).val());\r\n        return false;\r\n    }\r\n};\r\n","/**\r\n * Copyright Di Nkomo(TM) 2015, all rights reserved\r\n *\r\n */\r\nvar Forms =\r\n{\r\n    /**\r\n     * Definition lookup forms.\r\n     */\r\n    _def: {},\r\n\r\n    /**\r\n     *\r\n     */\r\n    init: function() {\r\n\r\n        // Attach helper keyboard to text inputs.\r\n        $('.text-input').focus(function() {\r\n            App.setKeyboardFocus(this);\r\n            $('#keyboard').fadeIn(300);\r\n        });\r\n\r\n        // Remove helper keyboard when focus is lost.\r\n        $('.en-text-input').focus(function() {\r\n            App.setKeyboardFocus(null);\r\n            $('#keyboard').fadeOut(300);\r\n        });\r\n\r\n        // Make keyboard draggable.\r\n        $('#keyboard').draggable({\r\n            drag: function(event) {\r\n                Utilities.log(event);\r\n            },\r\n            scroll: true,\r\n            scrollSensitivity: 80\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    getDefinitionForm: function(name) {\r\n        return this._def[name];\r\n    },\r\n\r\n    /**\r\n     * Prepares a language search input for AJAX calls.\r\n     *\r\n     * @param mixed input\r\n     * @param object items\r\n     * @param int max\r\n     * @param array plugins\r\n     */\r\n    setupLangSearch: function(input, items, max, plugins)\r\n    {\r\n        // Performance check.\r\n        if (!$(input)) return;\r\n\r\n        // Initialize selectize input.\r\n        var $select = $(input).selectize({\r\n            valueField: 'code',\r\n            labelField: 'name',\r\n            searchField: ['code', 'name', 'altNames'],\r\n            options: items,\r\n            plugins: (plugins || null),\r\n            create: false,\r\n            maxItems: (max || 1),\r\n            render: {\r\n                item: function(item, escape) {\r\n                    return  '<div>' +\r\n                                '<span class=\"name\">' + escape(item.name) + '</span>' +\r\n                            '</div>';\r\n                },\r\n                score: function(search) {\r\n                    return this.getScoreFunction(search);\r\n                },\r\n                option: function(item, escape)\r\n                {\r\n                    // Language title\r\n                    var title   = item.name;\r\n                    if (item.parentName && item.parentName.length)\r\n                        title += ' (a sub-language of '+ item.parentName +')';\r\n\r\n                    // Add a short desciption\r\n                    var hint = '';\r\n                    if (item.altNames && item.altNames.length)\r\n                        hint = '<span class=\"hint\"> &mdash; Also known as '+ item.altNames + '</span>';\r\n\r\n                    // Return formatted HTML\r\n                    return  '<div>' +\r\n                                '<span class=\"label\">' + escape(title) + '</span>' + hint +\r\n                            '</div>';\r\n                }\r\n            },\r\n            load: function(query, callback) {\r\n                if (!query.trim().length) return callback();\r\n                $.ajax({\r\n                    url: App.root +'api/0.1/language/search/' + App.urlencode(query.trim()),\r\n                    type: 'GET',\r\n                    error: function() {\r\n                        callback();\r\n                    },\r\n                    success: function(results) {\r\n                        callback(results);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * @param name\r\n     * @param options\r\n     */\r\n    setupDefinitionLookup: function(name, options)\r\n    {\r\n        // Retrieve form elements.\r\n        name = name || 'search';\r\n        options = options || {};\r\n\r\n        this._def[name] = {\r\n            form: $(document[name]),\r\n            results: options.results || $('#results'),\r\n            query: options.query || $(document[name].q),\r\n            clear:  options.clear || $('input[name=clear]'),\r\n            language: {\r\n                code: options.langCode || false,\r\n                name: options.langName || 'another language'\r\n            }\r\n        };\r\n\r\n        // Form submit function.\r\n        $(document[name]).submit([this._def[name]], function(event)\r\n        {\r\n            event.preventDefault();\r\n            var form = event.data[0];\r\n\r\n            // Performance check\r\n            var query\t= form.query.val().trim();\r\n            if (query.length < 2) {\r\n                form.query.focus();\r\n                return false;\r\n            }\r\n\r\n            // Display loading message\r\n            form.results.html('<div class=\"center\">looking up '+ query +'...</div>');\r\n\r\n            // Build endpoint.\r\n            // var endpoint = App.root + '0.1';\r\n            var endpoint = '/api/0.1';\r\n            if (options.langCode) {\r\n                endpoint += '/word/search/' + App.urlencode(query) + '?lang='+ options.langCode;\r\n            } else {\r\n                endpoint += '/search/' + App.urlencode(query) + '?method=fulltext';\r\n            }\r\n\r\n            // Start ajax request\r\n            $.ajax({\r\n                url: endpoint,\r\n                type: 'GET',\r\n                error: function(xhr, status, error) {\r\n                    App.log('XHR error on search form: '+ error +' ('+ xhr.status +')');\r\n                    form.results.html(\r\n                        '<div class=\"center\">'+\r\n                            'Seems like we ran into a snag <span class=\"fa fa-frown-o\"></span> '+\r\n                            'please try again later.'+\r\n                        '</div>');\r\n                },\r\n                success: function(results)\r\n                {\r\n                    if (results.length > 0)\r\n                    {\r\n                        var html\t=\r\n                            '<div class=\"center\">'+\r\n                            'we found <em>'+ results.length +'</em> results'+\r\n                            ' for <i>'+ query +'</i>.'+\r\n                            '</div><ol>';\r\n\r\n                        $.each(results, function(i, res) {\r\n\r\n                            switch (res.resourceType)\r\n                            {\r\n                                case 'language':\r\n                                    var parentData = res.parentLanguage ?\r\n                                        ' is a child language of '+\r\n                                        '<a href=\"'+ res.parentLanguage.uri +'\">'+\r\n                                        res.parentLanguage.name +\r\n                                        '</a>' : '';\r\n                                    html +=\r\n                                        '<li>'+\r\n                                        '<a href=\"'+ res.uri +'\">'+ res.name +'</a>'+\r\n                                        ' <small>(language)</small>'+ parentData +\r\n                                        '</li>';\r\n                                    break;\r\n\r\n                                default:\r\n                                    html +=\r\n                                        '<li>'+\r\n                                        '<a href=\"'+ res.uri +'\">'+ res.title +'</a>'+\r\n                                        ' <small>('+ res.subType +')</small>'+\r\n                                        ' is a '+ res.type +' that means <i>'+ res.translation.practical.eng +'</i> in '+\r\n                                        ' <a href=\"'+ res.mainLanguage.uri +'\">'+ res.mainLanguage.name +'</a>'+\r\n                                        '</li>';\r\n                            }\r\n                        });\r\n\r\n                        form.results.html(html +'</ol>');\r\n                    }\r\n\r\n                    else {\r\n                        form.results.html('<div class=\"center\">we couldn\\'t find anything matching that query <span class=\"fa fa-frown-o\"></span></div>');\r\n                    }\r\n                }\r\n            });\r\n\r\n            //return false;\r\n        });\r\n\r\n        // Form clearing.\r\n        this._def[name].clear.click(function() {\r\n           this.query.val('');\r\n           this.results.html('<div class=\"center\">Use this <em>&#10548;</em> to lookup words<br />in '+ this.language.name +'.</div>');\r\n           this.query.focus();\r\n       }.bind(this._def[name]));\r\n\r\n       // Submit form.\r\n       if (this._def[name].query.val().trim().length > 0) {\r\n           this._def[name].form.submit();\r\n       }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param name\r\n     */\r\n    resetDefinition: function(name)\r\n    {\r\n        // Performance check.\r\n        if (!this._def[name]) return;\r\n\r\n        // Clear form.\r\n        this._def[name].query.value = '';\r\n        this._def[name].results.html(\r\n            '<div class=\"center\">'+\r\n                'Use this <em>&#10548;</em> to lookup words'+\r\n                '<br />in '+ this._def[name].langName +'.'+\r\n            '</div>'\r\n        );\r\n\r\n        this._def[name].query.focus();\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    lookupDefinition: function(name)\r\n    {\r\n        // Performance check\r\n        if (!this._def[name]) return;\r\n\r\n        var query = this._def[name].query.value.trim();\r\n        if (query.length < 2) {\r\n            this._def[name].query.focus();\r\n            return false;\r\n        }\r\n\r\n        // Display loading message\r\n        this._def[name].results.html('<div class=\"center\">looking up '+ query +'...</div>');\r\n\r\n        // Start ajax request\r\n        $.ajax({\r\n            url: App.root +'/api/definition/search/' + App.urlencode(query),\r\n            type: 'POST',\r\n\r\n            // onError\r\n            error: function(xhr, status, error)\r\n            {\r\n                Forms.log('XHR error on search form: '+ xhr.status +' ('+ error +')');\r\n                Forms.setDefinitionResult(name,\r\n                    '<div class=\"center\">'+\r\n                        'Seems like we ran into a snag <span class=\"fa fa-frown-o\"></span> try again?'+\r\n                    '</div>'\r\n                );\r\n            },\r\n\r\n            // onSuccess\r\n            success: function(obj)\r\n            {\r\n                if (obj.results.definitions.length > 0)\r\n                {\r\n                    var html\t=\r\n                        '<div class=\"center\">'+\r\n                            'we found <em>'+ obj.results.definitions.length +'</em> definitions'+\r\n                            ' for <i>'+ obj.results.query +'</i>.'+\r\n                        '</div><ol>';\r\n\r\n                    $.each(obj.results.definitions, function(i, def)\r\n                    {\r\n                        html +=\r\n                            '<li>'+\r\n                                '<a href=\"'+ def.uri +'\">'+ def.data +'</a>'+\r\n                                ' <small>('+ def.type +')</small>'+\r\n                                ' is a word that means <i>'+ def.translation.en +'</i> in '+\r\n                                ' <a href=\"'+ def.language.uri +'\">'+ def.language.name +'</a>'+\r\n                            '</li>';\r\n                    });\r\n\r\n                    Forms.setDefinitionResult(name, html +'</ol>');\r\n                }\r\n\r\n                else {\r\n                    Forms.setDefinitionResult(name,\r\n                        '<div class=\"center\">'+\r\n                            'we couldn\\'t find anything matching that query <span class=\"fa fa-frown-o\"></span>'+\r\n                        '</div>'\r\n                    );\r\n                }\r\n            }\r\n        });\r\n\r\n        return false;\r\n    },\r\n\r\n    /**\r\n     * TODO: when is this method used?\r\n     */\r\n    setDefinitionResult: function(name, html)\r\n    {\r\n        // Performance check\r\n        if (!this._def[name]) return;\r\n\r\n        this._def[name].results.html(html);\r\n    },\r\n\r\n\tlog: function(msg) {\r\n\t\tif (console && this.isLocalEnvironment)\r\n            console.log('Forms.js - '+ msg);\r\n\t}\r\n};\r\n","/**\r\n * Copyright Di Nkomo(TM) 2015, all rights reserved\r\n *\r\n */\r\nvar Resources =\r\n{\r\n    /**\r\n     * Shortcut to verfify a definition title form input.\r\n     */\r\n    checkDefinitionTitle: function(input)\r\n    {\r\n        // Performance check.\r\n        if (!input || !input.trim().length) return;\r\n\r\n        // Add loading class.\r\n        input.addClass('loading');\r\n\r\n        var options =\r\n        {\r\n            langCode: false,\r\n            onError: function(xhr, status, error) {\r\n                Resources.log('XHR error: '+ error);\r\n            }.bind(input),\r\n            onSuccess: function(obj) {\r\n\r\n            }\r\n        };\r\n\r\n        // Lookup definition title.\r\n        this.findDefinitionByTitle(input.value, function() {\r\n\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Looks up a definition by title.\r\n     */\r\n    findDefinitionByTitle: function(title, options)\r\n    {\r\n        // Performance check.\r\n        if (!title.trim().length) return;\r\n        options = options || {};\r\n\r\n        // Build endpoint.\r\n        var endpoint = App.root +'/definition/exists/' + App.urlencode(title) +\r\n            (options.langCode ? '?lang='+ options.langCode : '');\r\n\r\n        // Lookup definitions by title.\r\n        $.ajax({\r\n            url: endpoint,\r\n            type: 'POST',\r\n            error: options.onError,\r\n            success: options.onSuccess\r\n        });\r\n    },\r\n\r\n\tlog: function(msg) {\r\n\t\tif (console && this.isLocalEnvironment)\r\n            console.log('Resources.js - '+ msg);\r\n\t}\r\n};\r\n","/**\r\n * Copyright Di Nkomo(TM) 2015, all rights reserved\r\n *\r\n */\r\nvar Utilities =\r\n{\r\n    /**\r\n     * @param string str\r\n     * @return string\r\n     */\r\n    urlencode : function(str)\r\n    {\r\n        return encodeURIComponent((str + '').toString())\r\n            .replace(/!/g, '%21')\r\n            .replace(/'/g, '%27')\r\n            .replace(/\\(/g, '%28')\r\n            .replace(/\\)/g, '%29')\r\n            .replace(/\\*/g, '%2A')\r\n            .replace(/%20/g, '+');\r\n    },\r\n\r\n    /**\r\n     * @param string|int key\r\n     * @param string value\r\n     */\r\n    setData: function(key, value) {\r\n        if (window.localStorage && typeof window.localStorage.setItem == 'function') {\r\n            window.localStorage.setItem(key, value);\r\n        }\r\n\r\n        else\r\n        {\r\n            if (!this.localStorage) {\r\n                this.localStorage = {};\r\n            }\r\n\r\n            this.localStorage[key] = value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param string|int key\r\n     * @param string value\r\n     */\r\n    setState: function(key, value) {\r\n        if (window.sessionStorage && typeof window.sessionStorage.setItem == 'function') {\r\n            window.sessionStorage.setItem(key, value);\r\n        }\r\n\r\n        else\r\n        {\r\n            if (!this.sessionStorage) {\r\n                this.sessionStorage = {};\r\n            }\r\n\r\n            this.sessionStorage[key] = value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param string|int key\r\n     * @param string value\r\n     */\r\n    getState: function(key, defaultValue) {\r\n        if (window.sessionStorage && typeof window.sessionStorage.getItem == 'function') {\r\n            window.sessionStorage.getItem(key, value);\r\n        }\r\n\r\n        else\r\n        {\r\n            if (!this.sessionStorage) {\r\n                this.sessionStorage = {};\r\n            }\r\n\r\n            this.sessionStorage[key] = value;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Logs a message to the console.\r\n     *\r\n     * @param mixed msg\r\n     * @return void\r\n     */\r\n    log: function(msg) {\r\n        if (this.isLocalEnvironment && console) {\r\n            console.log('App.js - '+ msg);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Logs an info message to the console.\r\n     *\r\n     * @param mixed msg\r\n     * @return void\r\n     */\r\n    info: function(msg) {\r\n\r\n        if (App.isLocalEnvironment && console && typeof console.info == 'function') {\r\n            console.info(msg);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Logs an error message to the console.\r\n     *\r\n     * @param string msg\r\n     * @return bool\r\n     */\r\n    error: function(msg) {\r\n\r\n        if (console && typeof console.error == 'function') {\r\n            console.error(msg);\r\n        }\r\n\r\n        return false;\r\n    }\r\n};\r\n","/**\r\n * Copyright Di Nkomo(TM) 2016, all rights reserved\r\n *\r\n * @author  Frank Yaw (frank@frnk.ca)\r\n */\r\n(function ( $ ) {\r\n\r\n    /**\r\n     *\r\n     */\r\n    $.fn.alphabetField = function( options ) {\r\n\r\n        // Add \"remote\" class.\r\n        this.addClass('remote');\r\n\r\n        // Convert selectize items to array of objects\r\n        if (typeof options.selectizeItems === 'object')\r\n        {\r\n            if (!Array.isArray(options.selectizeItems) || typeof options.selectizeItems.length === undefined)\r\n            {\r\n                var itemsArray = [];\r\n\r\n                for (var key in options.selectizeItems)\r\n                {\r\n                    var item = {};\r\n                    item[key] = options.selectizeItems[key];\r\n                    itemsArray.push(item);\r\n                }\r\n\r\n                options.selectizeItems = itemsArray;\r\n            }\r\n        }\r\n\r\n        // Initialize selectize input.\r\n        var $select = this.selectize({\r\n            valueField: 'code',\r\n            labelField: 'name',\r\n            searchField: ['code', 'name', 'transliteration'],\r\n            options: options.selectizeItems,\r\n            plugins: (options.selectizePlugins || null),\r\n            create: false,\r\n            maxItems: (options.maxItems || 10),\r\n            render: {\r\n\r\n                /**\r\n                 *\r\n                 */\r\n                item: function(item, escape) {\r\n                    return  '<div>' +\r\n                                '<span class=\"name\">' + escape(item.name) + '</span>' +\r\n                            '</div>';\r\n                },\r\n\r\n                /**\r\n                 *\r\n                 */\r\n                option: function(item, escape)\r\n                {\r\n                    // Return formatted HTML\r\n                    return  '<div>' +\r\n                                '<span class=\"label\">' + escape(item.name) + '</span>' +\r\n                                ' (' + escape(item.code) + ')' +\r\n                            '</div>';\r\n                }\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            load: function(query, callback) {\r\n                if (!query.trim().length) return callback();\r\n                $.ajax({\r\n                    url:  '/api/0.1/alphabet/search/' + App.urlencode(query.trim()),\r\n                    type: 'GET',\r\n                    error: function() {\r\n                        callback();\r\n                    },\r\n                    success: function(results) {\r\n                        callback(results);\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            onItemAdd: options.onItemAdd || null\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n}( jQuery ));\r\n","/**\r\n * Copyright Di Nkomo(TM) 2016, all rights reserved\r\n *\r\n * @author  Frank Yaw (frank@frnk.ca)\r\n */\r\n\r\n/**\r\n * @param options.form      Form name in DOM.\r\n * @param options.clear     Selector for clear button.\r\n * @param options.container Container for search results.\r\n */\r\nvar DiNkomoDictionary = function(options) {\r\n\r\n    options = options || {};\r\n\r\n    // Find dictionary form & form elements.\r\n    var form = {};\r\n    form.form = $(document[options.form || 'dictionary']);\r\n    form.query = $(document[options.form || 'dictionary'].q);\r\n    form.clear = $(options.clear || 'input[name=clear]');\r\n    form.container = $(options.results || '#results');\r\n    if (!form.form)\r\n    {\r\n        return Utilities.error('Dictionary form not found.');\r\n    }\r\n    else if (!form.query || !form.clear)\r\n    {\r\n        return Utilities.error('Dictionary form not valid.');\r\n    }\r\n    else if (!form.container)\r\n    {\r\n        return Utilities.error('Dictionary results container not found.');\r\n    }\r\n\r\n    // Container contents.\r\n    form.clearedContainer = form.container.html();\r\n\r\n    // API endpoint.\r\n    form.endpoint = '/api/0.1/search/:query';\r\n\r\n    /**\r\n     * On submit event listener for search form.\r\n     *\r\n     * @param object event\r\n     * @return void\r\n     */\r\n    var onSubmit = function(event) {\r\n\r\n        event.preventDefault();\r\n        var form = event.data;\r\n\r\n        // Performance check\r\n        var query = form.query.val().trim();\r\n        if (query.length < 2) {\r\n            form.query.focus();\r\n            return false;\r\n        }\r\n\r\n        // Display loading message\r\n        form.container.html('<div class=\"text-center\">looking up '+ query +'...</div>');\r\n\r\n        // Start ajax request\r\n        $.ajax({\r\n            url: form.endpoint.replace(':query', App.urlencode(query)) + '?lang='+ (options.langCode || ''),\r\n            type: 'GET',\r\n            error: form.onSubmitError,\r\n            success: function(results)\r\n            {\r\n                if (results.length > 0)\r\n                {\r\n                    var html =\r\n                        '<div class=\"text-center\">' +\r\n                            'we found <em>'+ results.length +'</em> results' +\r\n                            ' for <i>' + query + '</i>.' +\r\n                        '</div>' +\r\n                        '<ol>';\r\n\r\n                    for (var i in results)\r\n                    {\r\n                        switch (results[i].resourceType)\r\n                        {\r\n                            case 'language':\r\n                                html += form.formatLanguageResult(results[i]);\r\n                                break;\r\n\r\n                            case 'definition':\r\n                                html += form.formatDefinitionResult(results[i]);\r\n                                break;\r\n                        }\r\n                    }\r\n\r\n                    form.container.html(html +'</ol>');\r\n                }\r\n\r\n                else {\r\n                    form.container.html(\r\n                        '<div class=\"center\">' +\r\n                            'we couldn\\'t find anything matching that query ' +\r\n                            '<span class=\"fa fa-frown-o\"></span>' +\r\n                        '</div>'\r\n                    );\r\n                }\r\n            }\r\n        });\r\n\r\n        //return false;\r\n    };\r\n\r\n    /**\r\n     * Handles ajax errors.\r\n     *\r\n     * @param object xhr\r\n     * @param string status\r\n     * @param string error\r\n     */\r\n    form.onSubmitError = function(xhr, status, error) {\r\n\r\n        Utilities.error('Dictionary error: '+ error +' ('+ xhr.status +')');\r\n\r\n        this.results.html(\r\n            '<div class=\"center\">'+\r\n                'Seems like we ran into a snag <span class=\"fa fa-frown-o\"></span> ' +\r\n                'please try again later.' +\r\n            '</div>');\r\n\r\n    }.bind(form);\r\n\r\n    /**\r\n     * Formats a language result.\r\n     *\r\n     * @param object language\r\n     */\r\n    form.formatLanguageResult = function(language) {\r\n\r\n        var row =\r\n            '<li>' +\r\n                '<a href=\"' + language.uri + '\">' +\r\n                    language.name +\r\n                '</a> ';\r\n\r\n        // Add parent language.\r\n        if (language.parentCode.length >= 3) {\r\n            row +=\r\n            'is a child language of ' +\r\n            '<a href=\"' + language.parentUri + '\">' +\r\n                language.parentName +\r\n            '</a>';\r\n        }\r\n\r\n        else {\r\n            row += 'is a language';\r\n        }\r\n\r\n        row += '</li>';\r\n\r\n        return row;\r\n    };\r\n\r\n    /**\r\n     * Formats a definition results.\r\n     *\r\n     * @param object definition\r\n     */\r\n    form.formatDefinitionResult = function(definition) {\r\n\r\n        var row =\r\n            '<li>' +\r\n                '<a href=\"' + definition.uri + '\">' +\r\n                    definition.mainTitle +\r\n                '</a> ' +\r\n                '<small>' +\r\n                    '(' + definition.subType + ')' +\r\n                '</small> '+\r\n                'is a ' + definition.type + ' that means ' +\r\n                '<i>' + definition.translation.practical.eng + '</i> in '+\r\n                '<a href=\"' + definition.mainLanguage.uri + '\">' +\r\n                    definition.mainLanguage.name +\r\n                '</a>' +\r\n            '</li>';\r\n\r\n        return row;\r\n    };\r\n\r\n    // Attach onSubmit listener.\r\n    form.form.submit(form, onSubmit);\r\n\r\n    // Attach clear form listener.\r\n    form.clear.click(function() {\r\n       this.query.val('');\r\n       this.container.html(this.clearedContainer);\r\n       this.query.focus();\r\n   }.bind(form));\r\n\r\n   // If the form already has a query, look it up.\r\n   if (form.query.val().trim().length > 0) {\r\n       form.form.submit();\r\n   }\r\n\r\n    Utilities.info('Dictionary form initialized.');\r\n\r\n    return form;\r\n};\r\n","/**\r\n * Copyright Di Nkomo(TM) 2016, all rights reserved\r\n *\r\n * @author  Frank Yaw (frank@frnk.ca)\r\n */\r\n(function ( $ ) {\r\n\r\n    /**\r\n     *\r\n     */\r\n    $.fn.langSearch = function( options ) {\r\n\r\n        // Add \"remote\" class.\r\n        this.addClass('remote');\r\n\r\n        // Initialize selectize input.\r\n        var $select = this.selectize({\r\n            valueField: 'code',\r\n            labelField: 'name',\r\n            searchField: ['code', 'name', 'altNames'],\r\n            options: options.selectizeItems,\r\n            plugins: (options.selectizePlugins || null),\r\n            create: false,\r\n            maxItems: (options.maxItems || 1),\r\n            render: {\r\n\r\n                /**\r\n                 *\r\n                 */\r\n                item: function(item, escape) {\r\n                    return  '<div>' +\r\n                                '<span class=\"name\">' + escape(item.name) + '</span>' +\r\n                            '</div>';\r\n                },\r\n\r\n                /**\r\n                 *\r\n                 */\r\n                score: function(search) {\r\n                    return this.getScoreFunction(search);\r\n                },\r\n\r\n                /**\r\n                 *\r\n                 */\r\n                option: function(item, escape)\r\n                {\r\n                    // Language title\r\n                    var title   = item.name;\r\n                    if (item.parentName && item.parentName.length)\r\n                        title += ' (a sub-language of '+ item.parentName +')';\r\n\r\n                    // Add a short desciption\r\n                    var hint = '';\r\n                    if (item.altNames && item.altNames.length)\r\n                        hint = '<span class=\"hint\"> &mdash; Also known as '+ item.altNames + '</span>';\r\n\r\n                    // Return formatted HTML\r\n                    return  '<div>' +\r\n                                '<span class=\"label\">' + escape(title) + '</span>' + hint +\r\n                            '</div>';\r\n                }\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            load: function(query, callback) {\r\n                if (!query.trim().length) return callback();\r\n                $.ajax({\r\n                    url: App.root +'api/0.1/language/search/' + App.urlencode(query.trim()),\r\n                    type: 'GET',\r\n                    error: function() {\r\n                        callback();\r\n                    },\r\n                    success: function(results) {\r\n                        callback(results);\r\n                    }\r\n                });\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            onItemAdd: options.onItemAdd || null\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n}( jQuery ));\r\n"],"sourceRoot":"/source/"}